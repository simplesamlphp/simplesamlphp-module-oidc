{% set subPageTitle = 'Config Overview'|trans %}

{% extends "@oidc/base.twig" %}

{% block oidcContent %}

    <h4>{{ 'Database Migrations'|trans }}</h4>

    {% if databaseMigration.isMigrated %}
        <p><i class="fa fa-check" title="OK"></i>{{ 'All database migrations are implemented.'|trans }}</p>
    {% else %}
        <p class="red-text">
            <i class="fa fa-ban" title="Not OK"></i>
            {% trans %}There are database migrations that have not been implemented.
                Use the button below to run them now.{% endtrans %}
        </p>

        <form method="post" class="pure-form" action="{{ moduleURL('oidc/admin/run-migrations') }}">
            <input type="hidden" name="fromUi" value="1">
            <input type="hidden" name="migrate" value="1">
            <button class="pure-button pure-button-red ">{{ 'Run migrations'|trans }}</button>
        </form>
        <br>
    {% endif %}

    <h4>{{ 'Protocol Settings'|trans }}</h4>

    <table class="table pure-table pure-table-bordered ">
        <thead>
        <tr>
            <th>{{ 'Setting'|trans }}</th>
            <th>{{ 'Value'|trans }}</th>
        </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ 'Issuer'|trans }}</td>
                <td> {{ moduleConfig.getIssuer }}</td>
            </tr>
            <tr>
                <td>{{ 'Tokens Time-To-Live'|trans }}</td>
                <td>
                    <ul class="config">
                        <li>
                            {{ 'Authorization Code:'|trans }}
                            {{ moduleConfig.getAuthCodeDuration|date("%mm %dd %hh %i' %s''") }}
                        </li>
                        <li>
                            {{ 'Access Token:'|trans }}
                            {{ moduleConfig.getAccessTokenDuration|date("%mm %dd %hh %i' %s''") }}
                        </li>
                        <li>
                            {{ 'Refresh Token:'|trans }}
                            {{ moduleConfig.getRefreshTokenDuration|date("%mm %dd %hh %i' %s''") }}
                        </li>
                    </ul>

                </td>
            </tr>
            <tr>
                <td>{{ 'Default Authentication Source'|trans }}</td>
                <td> {{ moduleConfig.getDefaultAuthSourceId }}</td>
            </tr>
            <tr>
                <td>{{ 'User Identifier Attribute'|trans }}</td>
                <td> {{ moduleConfig.getUserIdentifierAttribute }}</td>
            </tr>
            <tr>
                <td>{{ 'PKI'|trans }}</td>
                <td>
                    <ul class="config">
                        <li>Private Key: {{ moduleConfig.getProtocolPrivateKeyPath }}</li>
                        <li>
                            Private Key Password Set:
                            {{ moduleConfig.getProtocolPrivateKeyPassPhrase ? 'Yes'|trans : 'No'|trans }}
                        </li>
                        <li>
                            {{ 'Public Key:'|trans }}
                            {{ moduleConfig.getProtocolCertPath }}
                        </li>
                    </ul>

                </td>
            </tr>
            <tr>
                <td>{{ 'Signing Algorithm'|trans }}</td>
                <td> {{ moduleConfig.getProtocolSigner.algorithmId }}</td>
            </tr>
            <tr>
                <td>{{ 'Supported ACRs'|trans }}</td>
                <td>
                    {% if moduleConfig.getAcrValuesSupported is not empty %}
                        <ul class="config">
                        {% for acr in moduleConfig.getAcrValuesSupported %}
                            <li>{{ acr }}</li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        {{ 'None defined'|trans }}
                    {% endif %}
                </td>
            </tr>
        </tbody>
    </table>

    <br>
    <h4>{{ 'Federation Settings'|trans }}</h4>

    <table class="table pure-table pure-table-bordered ">
        <thead>
        <tr>
            <th>{{ 'Setting'|trans }}</th>
            <th>{{ 'Value'|trans }}</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>{{ 'Federation Enabled:'|trans }}</td>
            <td> {{ moduleConfig.getFederationEnabled ? 'Yes'|trans : 'No'|trans }}</td>
        </tr>

        </tbody>
    </table>

{% endblock oidcContent -%}
